---
- name: Preflight to set up machine specific variables
  hosts: cluster
  gather_facts: false
  tasks:
    - debug:
        var: prefix | mandatory


- name: Provision manager in catalyst cloud
  hosts: manager
  gather_facts: false
  serial: 1
  tasks:
    - block:
        - import_tasks: tasks/catalyst-cloud.yml
      delegate_to: localhost

- name: Kick off docker management
  hosts: manager
  gather_facts: false
  become: true
  tasks:
    - name: Kick off rancheros server
      raw:  docker run -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher
      ignore_errors: true

    - name: Setup script to start interface
      template:
        src: templates/start-rancher.sh.j2
        dest: /usr/local/bin/start-rancher"
        owner: root
        group: root
        mode: 0755
      delegate_to: localhost

